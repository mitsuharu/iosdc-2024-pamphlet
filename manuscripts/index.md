# iOS デバイスから始める Bluetooth 制御の業務用サーマルプリンター対応アプリの作り方

<div class="author-info">
江本光晴（株式会社ゆめみ）<BR />
𝕏: @mitsuharu_e<BR />
Bluesky: @mitsuharu.bsky.social
</div>

昨今のペーパーレス化が進む社会でも、サーマル（感熱紙）プリントを見る機会は依然として多いです。iPhone や iPad を利用した POS レジからレシートを受け取った経験があるでしょう。その iPhone からどのようにレシートを印刷しているのか気になったことはありませんか。

印刷といえば iOS には Wi-Fi に接続されたプリンターを制御する AirPrint があります。しかしながら、業務用サーマルプリンターは Wi-Fi 非対応の機種も多く、AirPrint をサポートしていません。サーマルプリンター向けの印刷命令を実行する必要があります。この記事は、iOS デバイスを利用してサーマルプリンターを制御する方法を説明します。Bluetooth で接続可能なサーマルプリンターを対象として、接続や印刷する方法を説明します。また JavaScript で作られたレシート印刷に便利な OSS を iOS アプリで実行する方法も紹介します。この記事を読むことで、業務用サーマルプリンター対応アプリの実装方法を理解し、レシートを印刷できるようになります。今すぐにサーマルプリンターを買い求めたくなるでしょう。

### 免責事項・商標について

本記事は、製造メーカーが提供するドキュメントや私が所有する数台の実機から調査・検証した内容をまとめました。製造時期により実機のバージョンやファームウェアは異なる場合があるため、記載どおりにならない場合があります。また、製品名称は各社の商標または登録商標です。™ や ® の表記は省略します。

## 開発環境

開発環境は MacBook Pro 14 インチ 2021、Apple M1 Pro、macOS Sonoma 14.5 です。Xcode 15.3 で開発しました。検証機として iPhone SE（第３世代）、iOS 17.5 を利用しました。

### 対象のサーマルプリンターについて

本記事で対象するとサーマルプリンターは SUNMI 社が製造する “SUNMI 58mm Cloud Printer” です。58mm 幅の感熱紙を印刷できるサーマルプリンターです。無線のインタフェースとして Wi-Fi 4（2.4GHz）と Bluetooth 4.2 BLE を備えています。この機種の Bluetooth を利用して、サーマルプリンターを制御します。なお、私が所持する機種のモデルおよびソフトウェアバージョンは次のとおりです。

| Model | FirmWare version | SUNMI APP version | Partner APP version | MiniApp version |
| :--: | :-: | :-: | :-: | :-: |
| <div class="no-break">NT212_S</div> | 2.1.0 | 2.2.0 | 1.0.10 | 0.0.1 |

その機種の他に、80mm 幅のレシート印刷に対応した兄弟機 “80mm Kitchen Cloud Printer”、EPSON 社のモバイルサーマルプリンターを所有しています。これらの機種でも動作確認を行なっています。

## Bluetoothでの接続方法

- Bluetooth の基礎知識
- iOS での Bluetooth 接続手順
- Bluetooth のペアリング方法
  - CoreBluetooth フレームワークの概要
  - デバイスのスキャンと接続

## ESC/POS コマンドの概要

- ESC/POS コマンドとは
- 基本的なコマンドの紹介と使用例
- コマンドを使った印刷例
- iOS アプリでの ESC/POS コマンド実装

## コード例を交えた実装手順

- サンプルコードの解説
- エラーハンドリングとデバッグのポイント

## JavaScript OSSを使ったレシート印刷

- 利用する OSS の紹介（例：escpos-printer）
- OSS のインストールと設定
- サンプルコードと実装手順
- iOS と OSS の連携方法
- 応用編：カスタマイズと高度な機能

## レシートのデザインカスタマイズ

- 画像や QR コードの印刷
- 複数のプリンターへの対応
- まとめと今後の展望

## 記事のまとめ

- 今後の技術の発展と応用例
- 参考資料と追加リソース
